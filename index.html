<html>
  <head>
    <meta charset='utf-8'>
    <title>load</title>
  </head>
  <body>

    <script type="text/javascript">
      'use strict';
      var ScriptLoader;

      window.ScriptLoader = (function(_this){
        return function(){
          var loaded    = [];
          var loading   = {};
          var callbacks = {};

          var add_callback = function(url, callback){
            var $this = this;

            $this.callbacks[url] ? $this.callbacks[url] : $this.callbacks[url] = [];
            $this.callbacks[url].push( callback );
          }

          var exec_callbacks = function(url){
            var $this = this;

            var fn, k;
            var set = $this.callbacks[url]

            // Execute Callbacks for URL
            for (k in set) {
              var fn = set[k];
              fn();
            }

            delete $this.callbacks[url];
          }

          var add_loading = function(url, callback){
            var $this = this;

            $this.loading[url] = true;
            $this.add_callback(url, callback);
          }

          var add_loaded = function(url){
            var $this = this;

            $this.loaded.push(url);
            delete $this.loading[url];
          }

          var load = function( url, callback ) {
            var $this = this;

            if( ScriptLoader.loaded.indexOf(url) !== -1 ){
              $this.add_callback(url, callback);
              $this.exec_callbacks(url);
              return false;
            }

            if( ScriptLoader.loading[url]){
              $this.add_callback(url, callback);
              return false;
            }

            $this.add_loading(url, callback);

            var script = document.createElement( "script" )
            script.type = "text/javascript";

            if(script.readyState) {
              //IE
              script.onreadystatechange = function() {
                if ( script.readyState === "loaded" || script.readyState === "complete" ) {
                  script.onreadystatechange = null;

                  $this.add_loaded(url);
                  $this.exec_callbacks(url);
                }
              };
            } else {
              //Others
              script.onload = function() {
                $this.add_loaded(url);
                $this.exec_callbacks(url);
              };
            }

            script.src = url;
            document.getElementsByTagName("head")[0].appendChild( script );
          }

          var _public = {
            load:      load,
            loaded:    loaded,
            loading:   loading,
            callbacks: callbacks,

            add_loaded:     add_loaded,
            add_loading:    add_loading,
            add_callback:   add_callback,
            exec_callbacks: exec_callbacks
          }

          return _public;
        }
      })(this)();
    </script>

    <script>
      lodash_url = "https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.4.0/lodash.js" + '?' + Math.random();
      jq_url     = "https://code.jquery.com/jquery-2.2.0.js" + '?' + Math.random();

      ScriptLoader.load(lodash_url, function(){
        console.log("Script Loaded 1")
        console.log( _.map([1, 2, 3], function(n) { return n * 3; }) )
      })

      ScriptLoader.load(lodash_url, function(){
        console.log("Script Loaded 2")
        console.log( _.map([1, 2, 3], function(n) { return n * 3; }) )

        ScriptLoader.load(jq_url, function(){
          console.log("Script Loaded 4 :: Jquery ");
          console.log( $.fn.jquery );

          ScriptLoader.load(lodash_url, function(){
            console.log("Script Loaded 5")
            console.log( _.map([1, 2, 3], function(n) { return n * 3; }) )
          })
        })
      })

      ScriptLoader.load(lodash_url, function(){
        console.log("Script Loaded 3")
        console.log( _.map([1, 2, 3], function(n) { return n * 3; }) )
      })
    </script>

    <div role='role'>Load Script</div>
  </body>
</html>
